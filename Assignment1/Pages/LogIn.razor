@page "/login"
@using Assignment1.Auth
@namespace LoginComponent

@inject AuthenticationStateProvider AuthenticationStateProvider;
@inject NavigationManager NavigationManager;

<AuthorizeView Policy="MustBeLoggedIn">
    <NotAuthorized>
        <h1>Log in to your account</h1>
        <div class="formBlock">
            <form @onsubmit="@PerformLogIn">
                <label>Username:<input type="text" @bind-value="Username"/></label>
                <br/>
                <label>Password:<input type="password" @bind-value="Password"/></label>
                <br/>
                <button type="submit" class="btn btn-success">Log in</button>
                <p style="color: red; display: inline" class="pl-2">@ErrorMessage</p>
            </form>
        </div>
    </NotAuthorized>
    <Authorized>
        <h1>Log out of your account</h1>
        <button @onclick="PerformLogOut" class="btn btn-success">Log out</button>
    </Authorized>
</AuthorizeView>

@code {
    private string Username;
    private string Password;
    private string ErrorMessage;

    public async Task PerformLogIn()
    {
        ErrorMessage = "";
        
        try
        {
            ((CustomAuthenticationStateProvider) AuthenticationStateProvider).ValidateLogin(Username, Password);
            NavigationManager.NavigateTo("/");
            Username = "";
            Password = "";
        }
        catch (Exception e)
        {
            ErrorMessage = e.Message;
        }
    }

    public async Task PerformLogOut()
    {
        ErrorMessage = "";
        Username = "";
        Password = "";
        try
        {
            ((CustomAuthenticationStateProvider) AuthenticationStateProvider).Logout();
            NavigationManager.NavigateTo("/");
        }
        catch (Exception e)
        {
        }
    }

}